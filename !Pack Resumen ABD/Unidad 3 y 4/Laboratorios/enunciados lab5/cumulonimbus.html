<!doctype html>
<html lang="en">
<head>
<title>cumulonimbus</title>
<meta name="generator" content="Etherpad">
<meta name="author" content="Etherpad">
<meta name="changedby" content="Etherpad">
<meta charset="utf-8">
<style>
* {
  font-family: arial, sans-serif;
  font-size: 13px;
  line-height: 17px;
}
ul.indent {
  list-style-type: none;
}
ol {
  list-style-type: none;
  padding-left: 0;
}
body > ol {
  counter-reset: first second third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth;
}
ol > li:before {
  content: counter(first) ". ";
  counter-increment: first;
}
ol > ol > li:before {
  content: counter(first) "." counter(second) ". ";
  counter-increment: second;
}
ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) ". ";
  counter-increment: third;
}
ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) ". ";
  counter-increment: fourth;
}
ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) ". ";
  counter-increment: fifth;
}
ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) ". ";
  counter-increment: sixth;
}
ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) ". ";
  counter-increment: seventh;
}
ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) ". ";
  counter-increment: eighth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) ". ";
  counter-increment: ninth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) ". ";
  counter-increment: tenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) ". ";
  counter-increment: eleventh;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelfth) ". ";
  counter-increment: twelfth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelfth) "." counter(thirteenth) ". ";
  counter-increment: thirteenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelfth) "." counter(thirteenth) "." counter(fourteenth) ". ";
  counter-increment: fourteenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelfth) "." counter(thirteenth) "." counter(fourteenth) "." counter(fifteenth) ". ";
  counter-increment: fifteenth;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > li:before {
  content: counter(first) "." counter(second) "." counter(third) "." counter(fourth) "." counter(fifth) "." counter(sixth) "." counter(seventh) "." counter(eighth) "." counter(ninth) "." counter(tenth) "." counter(eleventh) "." counter(twelfth) "." counter(thirteenth) "." counter(fourteenth) "." counter(fifteenth) "." counter(sixteenth) ". ";
  counter-increment: sixteenth;
}
ol {
  text-indent: 0px;
}
ol > ol {
  text-indent: 10px;
}
ol > ol > ol {
  text-indent: 20px;
}
ol > ol > ol > ol {
  text-indent: 30px;
}
ol > ol > ol > ol > ol {
  text-indent: 40px;
}
ol > ol > ol > ol > ol > ol {
  text-indent: 50px;
}
ol > ol > ol > ol > ol > ol > ol {
  text-indent: 60px;
}
ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 70px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 80px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 90px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 100px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 110px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 120px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 130px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 140px;
}
ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol > ol {
  text-indent: 150px;
}
h1{font-size: 2.0em;line-height: 120%;}   h2{font-size: 1.5em;line-height: 120%;}   h3{font-size: 1.17em;line-height: 120%;}   h4{line-height: 120%;}   h5{font-size: 0.83em;line-height: 120%;}   h6{font-size: 0.75em;line-height: 120%;}   code{font-family: monospace;}[data-color="black"], .color\:black  { color:black; }
[data-color="red"], .color\:red    { color:red; }
[data-color="green"], .color\:green  { color:green; }
[data-color="blue"], .color\:blue   { color:blue; }
[data-color="yellow"], .color\:yellow { color:yellow; }
[data-color="orange"], .color\:orange { color:orange; }
</style>
</head>
<body>
Es un desastre total: he pasado de la felicidad absoluta imagin&#225;ndome con Ada en Tarawa, tirado en una hamaca con un daikiri en la mano, a volver al p&#225;nico absoluto.<br><br>Ya no puedo confiar en nadie, apenas te tengo a ti, que me has ayudado hasta ahora, y me pregunto... &#191;lo seguir&#225;s haciendo?.<br><br>Ahora estamos Ale y yo frente a frente, y solo la voluntad de uno de los dos prevalecer&#225;. Dicho esto, no tengo m&#225;s remedio que revelar su identidad, aunque eso me pueda hundir para siempre.<br><br>Eso s&#237;, antes necesito revalidar que me vas a ayudar en este &#250;ltimo suspiro y que no te pasaste a su lado perverso, por ello, te planteo un &#250;ltimo desaf&#237;o:<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>No hace mucho s&#233; que hicieron unos triggers para controlar una especializaci&#243;n disjunta total, la que sucede entre miembro y sus subclases ingenier&#237;a, ventas y gesti&#243;n. Pero hay otra especializaci&#243;n, aparentemente es menos estricta, la de proyectos, que es disjunta parcial: la superclase proyectos y sus subclases, web, erp y venta_almacen.<br><br>Son varias cosas que tenemos que revisar:<br><ol class="number"><li>Como es disjunta hay que asegurar la independencia de los miembros de subclases de proyectos, y tambi&#233;n la eliminaci&#243;n en la superclase tras el borrado en la subclase.</li><li>Como la especializaci&#243;n no es total, en este caso s&#237; puede haber objetos solamente en la superclase, pero atenci&#243;n, &#233;stos deben tener c&#243;digo de&nbsp; tipo &#x27;O&#x27; o se deber&#225; rechazar la inserci&#243;n, tambi&#233;n se debe validar con los otros c&#243;digos que los objetos deben estar previamente en las subclases&nbsp;&nbsp;&nbsp; correspondientes, o se debe rechazar la operaci&#243;n. Por suerte ya hay un trigger que impide el ingreso de un proyecto cuyo c&#243;digo no sea v&#225;lido, as&#237; que nos podemos ahorrar ese trabajo.</ol><br>Entonces, deber&#225;s desarrollar:<br>&nbsp;&nbsp;&nbsp;&nbsp;<br><ol class="number"><li>Una funci&#243;n que cuando la elimine a alg&#250;n elemento de las subclases lo eliminen autom&#225;ticamente de la superclase:</ol><br>*CREATE OR REPLACE FUNCTION borra_proyecto_superclase() RETURNS trigger AS $$<br>*<br>Los triggers para lanzarla son los siguientes:<br><br>*CREATE TRIGGER proyecto_erp AFTER DELETE ON erp FOR EACH ROW EXECUTE PROCEDURE borra_proyecto_superclase();<br>*CREATE TRIGGER proyecto_web AFTER DELETE ON web FOR EACH ROW EXECUTE PROCEDURE borra_proyecto_superclase();<br>*CREATE TRIGGER proyecto_venta_almacen AFTER DELETE ON venta_almacen FOR EACH ROW EXECUTE PROCEDURE borra_proyecto_superclase();<br><br>Deber&#225;s probar con la siguiente sentencia:<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>*delete from web where codigo_proyecto =&#x27;W-2018-2&#x27;;<br><br>2. Una funci&#243;n que, dado que la especializaci&#243;n es disjunta, garantice que no pueda existir el mismo objeto en m&#225;s de una subclase:<br>*<br>*CREATE OR REPLACE FUNCTION proyecto_ya_esta_en_otra_subclase() RETURNS trigger AS $$<br>*<br>Los triggers para lanzarla son los siguientes:<br>*<br>*CREATE TRIGGER proyecto_erp_no_en_otras BEFORE INSERT OR UPDATE ON erp FOR EACH ROW EXECUTE PROCEDURE proyecto_ya_esta_en_otra_subclase();<br>*CREATE TRIGGER proyecto_venta_almacen_no_en_otras BEFORE INSERT OR UPDATE ON venta_almacen FOR EACH ROW EXECUTE PROCEDURE proyecto_ya_esta_en_otra_subclase();<br>*CREATE TRIGGER proyecto_web_no_en_otras BEFORE INSERT OR UPDATE ON web FOR EACH ROW EXECUTE PROCEDURE proyecto_ya_esta_en_otra_subclase();<br><br>Deber&#225;s probarlos con la siguiente sentencia (que gracias al trigger ser&#225; rechazada porque ese proyecto ya est&#225; en la subclase Web):<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>*insert into erp values (&#x27;W-2018-1&#x27;);<br><br>3. Una funci&#243;n para comprobaci&#243;n de que los proyectos est&#225;n siendo introducidos en la subclase correcta. Es importante notar que aunque la especializaci&#243;n es parcial, si los proyectos son de tipo Web, Venta_almacen o ERP, deben ser a la vez introducidos en la subclase correspondiente y en proyecto, como si fuera total. Para ello debe tomarse en cuenta que los respectivos FK de las subclases a la superclase son diferibles.<br>*<br>*CREATE OR REPLACE FUNCTION comprueba_proyecto_subclase() RETURNS trigger AS $$<br>*<br>*CREATE TRIGGER proyecto_en_subclase BEFORE INSERT OR UPDATE ON proyecto FOR EACH ROW EXECUTE PROCEDURE comprueba_proyecto_subclase();<br><br>Deber&#225;s probar con la siguientes transacciones:<br><br>&#201;sta no funcionar&#225; porque se olvida la inserci&#243;n en subclase.<br><br>*BEGIN;<br>*<br>*SET CONSTRAINTS fk_ingenieria_miembro,desarrolla_participacion_total_proyecto,desarrolla_participacion_total_ingenieria,fk_web_proyecto DEFERRED;<br>*<br>*DO $$<br>*DECLARE<br>*&nbsp;&nbsp;&nbsp; codigo_proyecto VARCHAR;<br>*BEGIN<br>*&nbsp;&nbsp;&nbsp; insert into ingenieria values (&#x27;08822144-5&#x27;);&nbsp;<br>*&nbsp;&nbsp;&nbsp; insert into miembro values (&#x27;08822144-5&#x27;,&#x27;Carolina&#x27;,&#x27;Ingenier&#237;a&#x27;);&nbsp;<br>*&nbsp;&nbsp;&nbsp; codigo_proyecto:=nuevo_codigo_proyecto(&#x27;W&#x27;);<br>*&nbsp;&nbsp;&nbsp; insert into proyecto values (codigo_proyecto,&#x27;phppgadmindecente&#x27;,&#x27;Web&#x27;,null,null,1000,&#x27;<a href="http&#x3a;&#x2F;&#x2F;dei2&#x2e;uca&#x2e;edu&#x2e;sv&#x2F;phppgadmin">http:&#x2F;&#x2F;dei2.uca.edu.sv&#x2F;phppgadmin</a>&#x27;);&nbsp;&nbsp;&nbsp;&nbsp;<br>*&nbsp;&nbsp;&nbsp; insert into desarrolla values (codigo_proyecto,&#x27;08822144-5&#x27;,&#x27;Desarrollo&#x27;);<br>*END $$;<br>*<br>*COMMIT;<br><br>&#201;sta tampoco tendr&#225; &#233;xito porque la subclase es incorrecta<br><br>*BEGIN;<br>*<br>*SET CONSTRAINTS fk_ingenieria_miembro,desarrolla_participacion_total_proyecto,desarrolla_participacion_total_ingenieria,fk_web_proyecto DEFERRED;<br>*<br>*DO $$<br>*DECLARE<br>*&nbsp;&nbsp;&nbsp; codigo_proyecto VARCHAR;<br>*BEGIN<br>*&nbsp;&nbsp;&nbsp; insert into ingenieria values (&#x27;08822144-5&#x27;);&nbsp;<br>*&nbsp;&nbsp;&nbsp; insert into miembro values (&#x27;08822144-5&#x27;,&#x27;Carolina&#x27;,&#x27;Ingenier&#237;a&#x27;);&nbsp;<br>*&nbsp;&nbsp;&nbsp; codigo_proyecto:=nuevo_codigo_proyecto(&#x27;O&#x27;);<br>*&nbsp;&nbsp;&nbsp; insert into web values (codigo_proyecto,&#x27;<a href="http&#x3a;&#x2F;&#x2F;dei2&#x2e;uca&#x2e;edu&#x2e;sv&#x2F;phppgadmin">http:&#x2F;&#x2F;dei2.uca.edu.sv&#x2F;phppgadmin</a>&#x27;,80,40);<br>*&nbsp;&nbsp;&nbsp; insert into proyecto values (codigo_proyecto,&#x27;phppgadmindecente&#x27;,&#x27;Web&#x27;,null,null,1000,&#x27;<a href="http&#x3a;&#x2F;&#x2F;dei2&#x2e;uca&#x2e;edu&#x2e;sv&#x2F;phppgadmin">http:&#x2F;&#x2F;dei2.uca.edu.sv&#x2F;phppgadmin</a>&#x27;);&nbsp;&nbsp;&nbsp;&nbsp;<br>*&nbsp;&nbsp;&nbsp; insert into desarrolla values (codigo_proyecto,&#x27;08822144-5&#x27;,&#x27;Desarrollo&#x27;);<br>*END $$;<br>*<br>*COMMIT;<br>*<br>Al fin, la siguiente transacci&#243;n s&#237; deber&#237;a funcionar correctamente.<br><br>*BEGIN;<br>*<br>*SET CONSTRAINTS fk_ingenieria_miembro,desarrolla_participacion_total_proyecto,desarrolla_participacion_total_ingenieria,fk_web_proyecto DEFERRED;<br>*<br>*DO $$<br>*DECLARE<br>*&nbsp;&nbsp;&nbsp; codigo_proyecto VARCHAR;<br>*BEGIN<br>*&nbsp;&nbsp;&nbsp; insert into ingenieria values (&#x27;08822144-5&#x27;);&nbsp;<br>*&nbsp;&nbsp;&nbsp; insert into miembro values (&#x27;08822144-5&#x27;,&#x27;Carolina&#x27;,&#x27;Ingenier&#237;a&#x27;);&nbsp;<br>*&nbsp;&nbsp;&nbsp; codigo_proyecto:=nuevo_codigo_proyecto(&#x27;W&#x27;);<br>*&nbsp;&nbsp;&nbsp; insert into web values (codigo_proyecto,&#x27;<a href="http&#x3a;&#x2F;&#x2F;dei2&#x2e;uca&#x2e;edu&#x2e;sv&#x2F;phppgadmin">http:&#x2F;&#x2F;dei2.uca.edu.sv&#x2F;phppgadmin</a>&#x27;,80,40);<br>*&nbsp;&nbsp;&nbsp; insert into proyecto values (codigo_proyecto,&#x27;phppgadmindecente&#x27;,&#x27;Web&#x27;,null,null,1000,&#x27;<a href="http&#x3a;&#x2F;&#x2F;dei2&#x2e;uca&#x2e;edu&#x2e;sv&#x2F;phppgadmin">http:&#x2F;&#x2F;dei2.uca.edu.sv&#x2F;phppgadmin</a>&#x27;);&nbsp;&nbsp;&nbsp;&nbsp;<br>*&nbsp;&nbsp;&nbsp; insert into desarrolla values (codigo_proyecto,&#x27;08822144-5&#x27;,&#x27;Desarrollo&#x27;);<br>*END $$;<br>*<br>*COMMIT;<br><br>Por favor resuelve el anterior problema y espera mis instrucciones en la tabla kurt_out.<br>
</body>
</html>
